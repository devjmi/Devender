<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Unified Insurance Tools</title>
    <script src="https://cdn.tailwindcss.com">

// --- School Bus Calculator Logic ---

        document.addEventListener('DOMContentLoaded', () => {
            const premiumForm = document.getElementById('premiumForm');
            const seatingCapacityInput = document.getElementById('seatingCapacity');
            const carryingCapacityDisplay = document.getElementById('carryingCapacity');
            const resultsSection = document.getElementById('results');
            const messageBox = document.getElementById('messageBox');
            const messageText = document.getElementById('messageText');
            const closeMessageBoxBtn = document.getElementById('closeMessageBoxBtn');

            // Global variable to store calculated data for both display and PDF
            let calculatedData = {};

            function showMessage(text) {
                messageText.textContent = text;
                messageBox.classList.remove('hidden');
            }

            closeMessageBoxBtn.addEventListener('click', () => {
                messageBox.classList.add('hidden');
            });

            const calculateAndDisplayPremium = () => {
                const idv = parseFloat(document.getElementById('idv').value);
                const seatingCapacity = parseInt(seatingCapacityInput.value);
                
                if (seatingCapacity < 8) {
                    showMessage("Seating capacity cannot be less than 8.");
                    return;
                }
                
                const licensedPassengers = seatingCapacity > 0 ? seatingCapacity - 1 : 0;
                const ncb = parseInt(document.getElementById('ncb').value);
                const selectedCompany = document.getElementById('companyDiscount').value;
                const isCngFuel = document.getElementById('cngFuel').checked;
                const llDriverValue = parseFloat(document.getElementById('llDriver').value) || 0;

                carryingCapacityDisplay.value = licensedPassengers;
                
                if (!idv || !seatingCapacity) {
                    resultsSection.classList.add('hidden');
                    return;
                }

                const odRate = 1.739;
                const basicOdPremium = idv * (odRate / 100);

                let loadingPremium;
                if (seatingCapacity <= 19) {
                    loadingPremium = 350;
                } else if (seatingCapacity >= 20 && seatingCapacity <= 37) {
                    loadingPremium = 450;
                } else {
                    loadingPremium = 550;
                }
                
                const cngOdPremiumRate = 0.05;
                let cngOdPremium = isCngFuel ? basicOdPremium * cngOdPremiumRate : 0;
                
                const odPremiumBeforeNcb = basicOdPremium + loadingPremium + cngOdPremium;
                
                const ncbDiscount = odPremiumBeforeNcb * (ncb / 100);
                const odPremiumAfterNcb = odPremiumBeforeNcb - ncbDiscount;
                
                const imt23Rate = 0.15;
                const imt23PremiumBeforeDiscount = odPremiumAfterNcb * imt23Rate;

                let discountRate = 0;
                let discountLabelText = 'Company Discount';
                let towingCharge = 0;
                
                if (selectedCompany === 'digit') {
                    discountRate = 0.99;
                    discountLabelText = 'Digit Discount (99%)';
                } else if (selectedCompany === 'tata') {
                    discountRate = 0.95;
                    discountLabelText = 'TATA AIG Discount (95%)';
                } else if (selectedCompany === 'reliance') {
                    discountRate = 0.95;
                    discountLabelText = 'Reliance General Discount (95%)';
                    towingCharge = 500;
                } else if (selectedCompany === 'icici') {
                    discountRate = 0.99;
                    discountLabelText = 'ICICI Lombard Discount (99%)';
                    towingCharge = 0;
                }

                const odPremiumAfterCompanyDiscount = odPremiumAfterNcb * (1 - discountRate);
                const imt23PremiumAfterCompanyDiscount = imt23PremiumBeforeDiscount * (1 - discountRate);
                const cngOdPremiumAfterDiscount = isCngFuel ? cngOdPremium * (1 - discountRate) : 0;

                const companyDiscountAmount = (odPremiumAfterNcb + imt23PremiumBeforeDiscount + cngOdPremium) * discountRate;

                const basicTpPremium = 12192;
                const licensedPassengerPremium = licensedPassengers * 745;
                const totalTpPremium = basicTpPremium + licensedPassengerPremium;
                
                let cngTpPremium = isCngFuel ? 60 : 0;
                let llDriverPremium = llDriverValue > 0 ? (llDriverValue === 1 ? 50 : (llDriverValue === 2 ? 100 : llDriverValue * licensedPassengers)) : 0;
                
                const totalPremiumBeforeGst = odPremiumAfterCompanyDiscount + imt23PremiumAfterCompanyDiscount + totalTpPremium + towingCharge + cngTpPremium + cngOdPremiumAfterDiscount + llDriverPremium;
                
                const gstAmount = totalPremiumBeforeGst * 0.18;
                const finalTotalPremiumWithGst = totalPremiumBeforeGst + gstAmount;

                // Update the global calculatedData object
                calculatedData = {
                    idv,
                    seatingCapacity,
                    licensedPassengers,
                    odPremiumAfterCompanyDiscount,
                    cngOdPremiumAfterDiscount,
                    totalTpPremium,
                    imt23PremiumAfterCompanyDiscount,
                    towingCharge,
                    cngTpPremium,
                    llDriverPremium,
                    companyDiscountLabel: discountLabelText,
                    companyDiscountAmount,
                    subtotalPremium: totalPremiumBeforeGst,
                    gstAmount,
                    totalPremium: finalTotalPremiumWithGst,
                };

                // Display all breakdown lines, even if zero
                document.getElementById('odPremium').textContent = formatCurrency(calculatedData.odPremiumAfterCompanyDiscount);
                document.getElementById('cngOdPremiumAmount').textContent = formatCurrency(calculatedData.cngOdPremiumAfterDiscount);
                document.getElementById('tpPremium').textContent = formatCurrency(calculatedData.totalTpPremium);
                document.getElementById('imt23Premium').textContent = formatCurrency(calculatedData.imt23PremiumAfterCompanyDiscount);
                document.getElementById('towingChargePremium').textContent = formatCurrency(calculatedData.towingCharge);
                document.getElementById('cngTpPremiumAmount').textContent = formatCurrency(calculatedData.cngTpPremium);
                document.getElementById('llDriverPremiumAmount').textContent = formatCurrency(calculatedData.llDriverPremium);
                document.getElementById('companyDiscountLabel').textContent = calculatedData.companyDiscountLabel;
                document.getElementById('companyDiscountAmount').textContent = formatCurrency(calculatedData.companyDiscountAmount, true);
                
                document.getElementById('subtotalPremium').textContent = formatCurrency(calculatedData.subtotalPremium);
                document.getElementById('gstAmount').textContent = formatCurrency(calculatedData.gstAmount);
                document.getElementById('totalPremium').textContent = formatCurrency(calculatedData.totalPremium);

                resultsSection.classList.remove('hidden');
            };

            const calculateAndDisplayCommission = () => {
                const totalPremiumBeforeGst = calculatedData?.subtotalPremium || 0;
                const commissionRateInput = parseFloat(document.getElementById('commissionRate').value);
                
                if (isNaN(totalPremiumBeforeGst) || totalPremiumBeforeGst === 0) {
                     document.getElementById('premiumForCommission').textContent = formatCurrency(0);
                     document.getElementById('basicCommission').textContent = formatCurrency(0);
                     document.getElementById('tdsOnCommission').textContent = formatCurrency(0);
                     document.getElementById('totalCommission').textContent = formatCurrency(0);
                     return;
                }
                
                const commissionRate = commissionRateInput / 100;
                const basicCommission = totalPremiumBeforeGst * commissionRate;
                const tdsRate = 0.02;
                const tdsOnCommission = basicCommission * tdsRate;
                const totalCommission = basicCommission - tdsOnCommission;
                
                document.getElementById('premiumForCommission').textContent = formatCurrency(totalPremiumBeforeGst);
                document.getElementById('commissionRateDisplay').textContent = commissionRateInput;
                document.getElementById('basicCommission').textContent = formatCurrency(basicCommission);
                document.getElementById('tdsOnCommission').textContent = formatCurrency(tdsOnCommission);
                document.getElementById('totalCommission').textContent = formatCurrency(totalCommission);
            };

            premiumForm.addEventListener('submit', function(event) {
                event.preventDefault();
                calculateAndDisplayPremium();
            });

            seatingCapacityInput.addEventListener('input', function() {
                const seatingCapacity = parseInt(this.value);
                const licensedPassengers = seatingCapacity > 0 ? seatingCapacity - 1 : 0;
                carryingCapacityDisplay.value = licensedPassengers > 0 ? licensedPassengers : "N/A";
            });

            const toggleCommissionBtn = document.getElementById('toggleCommissionBtn');
            const commissionModal = document.getElementById('commissionModal');
            const closeModalBtn = document.getElementById('closeModalBtn');
            const commissionRateInput = document.getElementById('commissionRate');

            toggleCommissionBtn.addEventListener('click', function() {
                if (!Object.keys(calculatedData).length) {
                     showMessage("Please calculate the premium first.");
                     return;
                }
                commissionModal.classList.remove('hidden');
                calculateAndDisplayCommission();
            });

            closeModalBtn.addEventListener('click', function() {
                commissionModal.classList.add('hidden');
            });
            
            commissionRateInput.addEventListener('input', calculateAndDisplayCommission);

            const generatePdfBtn = document.getElementById('generatePdfBtn');
            const generatePdfText = document.getElementById('generatePdfText');
            const generatePdfLoader = document.getElementById('generatePdfLoader');
            const pdfContent = document.getElementById('pdfContent');
            
            generatePdfBtn.addEventListener('click', () => {
                if (!Object.keys(calculatedData).length) {
                    showMessage("Please calculate the premium first.");
                    return;
                }
                
                // Update the PDF content with the calculated data
                document.getElementById('pdf-idv').textContent = formatCurrency(calculatedData.idv);
                document.getElementById('pdf-seating-capacity').textContent = calculatedData.seatingCapacity;
                document.getElementById('pdf-od-premium').textContent = formatCurrency(calculatedData.odPremiumAfterCompanyDiscount);
                document.getElementById('pdf-cng-od-premium').textContent = formatCurrency(calculatedData.cngOdPremiumAfterDiscount);
                document.getElementById('pdf-company-discount-label').textContent = calculatedData.companyDiscountLabel;
                document.getElementById('pdf-company-discount-amount').textContent = formatCurrency(calculatedData.companyDiscountAmount, true);
                document.getElementById('pdf-tp-premium').textContent = formatCurrency(calculatedData.totalTpPremium);
                document.getElementById('pdf-imt23-premium').textContent = formatCurrency(calculatedData.imt23PremiumAfterCompanyDiscount);
                document.getElementById('pdf-towing-charge').textContent = formatCurrency(calculatedData.towingCharge);
                document.getElementById('pdf-cng-tp-premium').textContent = formatCurrency(calculatedData.cngTpPremium);
                document.getElementById('pdf-ll-driver-premium').textContent = formatCurrency(calculatedData.llDriverPremium);
                document.getElementById('pdf-subtotal-premium').textContent = formatCurrency(calculatedData.subtotalPremium);
                document.getElementById('pdf-gst-amount').textContent = formatCurrency(calculatedData.gstAmount);
                document.getElementById('pdf-total-premium').textContent = formatCurrency(calculatedData.totalPremium);

                // Temporarily disable the button and show loading state
                generatePdfBtn.disabled = true;
                generatePdfText.textContent = 'Generating...';
                generatePdfLoader.classList.remove('hidden');
                
                // Use a short delay to allow the DOM to update before printing
                setTimeout(() => {
                    window.print();
                    
                    // Re-enable the button and hide loading state after printing
                    generatePdfBtn.disabled = false;
                    generatePdfText.textContent = 'Generate PDF';
                    generatePdfLoader.classList.add('hidden');
                }, 500);
            });
        });

        // Helper function to format numbers as Indian Rupees
        function formatCurrency(amount, isDiscount = false) {
            const formatter = new Intl.NumberFormat('en-IN', {
                style: 'currency',
                currency: 'INR',
                minimumFractionDigits: 2,
            });

            if (isDiscount) {
                return `- ${formatter.format(amount).replace('₹', '')}`;
            } else {
                return formatter.format(amount);
            }
        }
    
</script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        /* Base font and transition for a smooth experience */
        body {
            font-family: 'Inter', sans-serif;
            transition: background-color 0.3s ease;
        }
        /* Custom animation for results box */
        @keyframes fade-in {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        .animate-fade-in {
            animation: fade-in 0.5s ease-out forwards;
        }
    </style>
</head>
<body class="bg-gray-50 flex items-center justify-center min-h-screen p-4 sm:p-6 md:p-8">

    <div class="bg-white p-6 sm:p-8 rounded-3xl shadow-2xl w-full max-w-4xl transform transition-all duration-500 hover:scale-[1.01] overflow-hidden">
        
        <div class="text-center mb-6">
            <h1 class="text-4xl font-extrabold text-indigo-800 mb-2">Insurance Tools Hub</h1>
            <p class="text-blue-900">A Collection Of Calculators And Links For Insurance Professionals<br>By Devender Kumar</p>
        </div>

        <div class="flex flex-wrap justify-center gap-2 mb-6 border-b border-gray-200">
            <button id="tab-idv" class="tab-button px-4 py-2 text-sm sm:text-base font-semibold text-gray-700 hover:text-indigo-600 transition-colors duration-200 border-b-2 border-transparent hover:border-indigo-500 focus:outline-none focus:border-indigo-500">
                IDV Calculator
            </button>
            <button id="tab-depreciation" class="tab-button px-4 py-2 text-sm sm:text-base font-semibold text-gray-700 hover:text-indigo-600 transition-colors duration-200 border-b-2 border-transparent hover:border-indigo-500 focus:outline-none focus:border-indigo-500">
                Depreciation
            </button>
            <button id="tab-commission" class="tab-button px-4 py-2 text-sm sm:text-base font-semibold text-gray-700 hover:text-indigo-600 transition-colors duration-200 border-b-2 border-transparent hover:border-indigo-500 focus:outline-none focus:border-indigo-500">
                Commission
            </button>
            <button id="tab-cutpay" class="tab-button px-4 py-2 text-sm sm:text-base font-semibold text-gray-700 hover:text-indigo-600 transition-colors duration-200 border-b-2 border-transparent hover:border-indigo-500 focus:outline-none focus:border-indigo-500">
                Cut Pay
            </button>
            <button id="tab-schoolbus" class="tab-button flex justify-center items-center text-center px-4 py-2 text-sm sm:text-base font-semibold text-gray-700 hover:text-indigo-600 transition-colors duration-200 border-b-2 border-transparent hover:border-indigo-500 focus:outline-none focus:border-indigo-500">School Bus Premium Calculator</button>
            <button id="tab-vahan" class="tab-button px-4 py-2 text-sm sm:text-base font-semibold text-gray-700 hover:text-indigo-600 transition-colors duration-200 border-b-2 border-transparent hover:border-indigo-500 focus:outline-none focus:border-indigo-500">
                Vahan Data
            </button>
        </div>

        <div id="content-container" class="flex flex-col items-center">

            <div id="idv-section" class="tab-content w-full max-w-lg p-4 sm:p-6 bg-gray-50 rounded-2xl shadow-inner border border-gray-100 transition-all duration-300 transform scale-100">
                <h2 class="text-2xl font-bold text-center text-indigo-600 mb-4">Vehicle's IDV Calculator</h2>
                <p class="text-center text-gray-500 mb-6">Calculate your vehicle's approximate IDV based on its age.</p>
                
                <form id="idv-form" class="space-y-4">
                    <div>
                        <label for="initial-value" class="block text-sm font-semibold text-gray-700">Vehicle Purchase Amount:</label>
                        <input type="number" id="initial-value" required class="mt-1 block w-full px-4 py-2 bg-white border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition duration-200">
                    </div>

                    <div>
                        <label for="mfg-year" class="block text-sm font-semibold text-gray-700">Manufacturing Year:</label>
                        <input type="number" id="mfg-year" required placeholder="e.g., 2022" class="mt-1 block w-full px-4 py-2 bg-white border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition duration-200">
                    </div>
                    
                    <button type="submit" class="w-full bg-indigo-500 text-white font-bold py-3 rounded-lg shadow-md hover:bg-indigo-600 transition-all duration-300 transform hover:scale-105">
                        Calculate IDV
                    </button>
                </form>
            </div>

            <div id="depreciation-section" class="tab-content w-full max-w-lg p-4 sm:p-6 bg-gray-50 rounded-2xl shadow-inner border border-gray-100 transition-all duration-300 transform scale-100 hidden">
                <h2 class="text-2xl font-bold text-center text-indigo-600 mb-4">Depreciation Calculator</h2>
                <p class="text-center text-gray-500 mb-6">Calculate remaining value after a fixed depreciation percentage.</p>
                
                <form id="depreciation-form" class="space-y-4">
                    <div>
                        <label for="dep-initial-value" class="block text-sm font-medium text-slate-600 mb-2">Asset Value:</label>
                        <input type="number" id="dep-initial-value" placeholder="e.g., 100000" class="form-input w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500">
                    </div>
                    
                    <button type="submit" class="w-full bg-indigo-500 text-white font-bold py-3 rounded-lg shadow-md hover:bg-indigo-600 transition-all duration-300 transform hover:scale-105">
                        Calculate
                    </button>
                </form>
            </div>

            <div id="commission-section" class="tab-content w-full max-w-lg p-4 sm:p-6 bg-gray-50 rounded-2xl shadow-inner border border-gray-100 transition-all duration-300 transform scale-100 hidden">
                <h2 class="text-2xl font-bold text-center text-indigo-600 mb-4">Commission Calculator</h2>
                <p class="text-center text-gray-500 mb-6">Calculate your commission with TDS deduction.</p>

                <form id="commission-form" class="space-y-6">
                    <div class="space-y-4">
                        <h3 class="font-semibold text-lg text-gray-700 border-b border-gray-200 pb-2">Own Damage (OD)</h3>
                        <div>
                            <label for="odPremium" class="block text-sm font-medium text-gray-600 mb-2">OD Premium:</label>
                            <input type="number" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 bg-white transition" id="odPremium" value="0" placeholder="e.g., 10000">
                        </div>
                        <div>
                            <label for="odCommissionRate" class="block text-sm font-medium text-gray-600 mb-2">OD Commission Rate (%):</label>
                            <input type="number" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 bg-white transition" id="odCommissionRate" value="0" placeholder="e.g., 15">
                        </div>
                    </div>

                    <div class="space-y-4">
                        <h3 class="font-semibold text-lg text-gray-700 border-b border-gray-200 pb-2">Third-Party (TP)</h3>
                        <div>
                            <label for="tpPremium" class="block text-sm font-medium text-gray-600 mb-2">TP Premium:</label>
                            <input type="number" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 bg-white transition" id="tpPremium" value="0" placeholder="e.g., 2000">
                        </div>
                        <div>
                            <label for="tpCommissionRate" class="block text-sm font-medium text-gray-600 mb-2">TP Commission Rate (%):</label>
                            <input type="number" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 bg-white transition" id="tpCommissionRate" value="0" placeholder="e.g., 5">
                        </div>
                    </div>

                    <div>
                        <label for="tdsRate" class="block text-sm font-medium text-gray-600 mb-2">TDS Rate (%):</label>
                        <input type="number" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 bg-white transition" id="tdsRate" value="2" placeholder="e.g., 2">
                    </div>
                    
                    <button type="submit" class="w-full bg-indigo-500 text-white font-bold py-3 rounded-lg shadow-md hover:bg-indigo-600 transition-all duration-300 transform hover:scale-105">
                        Calculate Commission
                    </button>
                </form>
            </div>

            <div id="cutpay-section" class="tab-content w-full max-w-lg p-4 sm:p-6 bg-gray-50 rounded-2xl shadow-inner border border-gray-100 transition-all duration-300 transform scale-100 hidden">
                <h2 class="text-2xl font-bold text-center text-indigo-600 mb-4">Cut Pay Calculator</h2>
                <p class="text-center text-gray-500 mb-6">Calculate the final payable amount using the provided formula.</p>

                <form id="cutpay-form" class="space-y-4">
                    <div>
                        <label for="cutpay-total-premium" class="block text-sm font-semibold text-gray-700">Total Premium:</label>
                        <input type="number" id="cutpay-total-premium" placeholder="Enter total premium..." step="0.01" class="mt-1 block w-full px-4 py-2 bg-white border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-indigo-500 transition duration-200">
                    </div>

                    <div>
                        <label for="cutpay-cut-rate" class="block text-sm font-semibold text-gray-700">Cut Rate (%):</label>
                        <input type="number" id="cutpay-cut-rate" placeholder="Enter cut rate..." step="0.01" class="mt-1 block w-full px-4 py-2 bg-white border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-indigo-500 transition duration-200">
                    </div>

                    <button type="submit" class="w-full bg-indigo-500 text-white font-bold py-3 rounded-lg shadow-md hover:bg-indigo-600 transition-all duration-300 transform hover:scale-105">
                        Calculate Final Pay
                    </button>
                </form>
            </div>
            
            
            <div id="schoolbus-section" class="tab-content w-full p-0 bg-transparent border-0 hidden">
                

    <!-- Calculator Container -->
    <div id="calculatorContainer" class="bg-white p-4 rounded-lg shadow-lg w-full max-w-sm md:max-w-md z-10 relative">
        
        <!-- Header -->
        <div class="text-center mb-4">
            <h1 class="text-lg font-extrabold text-blue-800 mb-1">School Bus Premium and Commission Calculator</h1>
        </div>

        <!-- Input Form -->
        <form id="premiumForm" class="space-y-3">

            <!-- IDV -->
            <div>
                <label for="idv" class="block text-sm font-medium text-gray-700">Insured Declared Value (IDV) in ₹</label>
                <input type="number" id="idv" class="mt-1 p-2 border border-gray-300 rounded-md w-full text-sm focus:ring-blue-500 focus:border-blue-500 transition-colors" placeholder="e.g., 500000" required>
            </div>

            <!-- Seating Capacity & Carrying Capacity on one line -->
            <div class="grid grid-cols-2 gap-3">
                <!-- Seating Capacity -->
                <div>
                    <label for="seatingCapacity" class="block text-sm font-medium text-gray-700">Seating Capacity</label>
                    <input type="number" id="seatingCapacity" min="8" class="mt-1 p-2 border border-gray-300 rounded-md w-full text-sm focus:ring-blue-500 focus:border-blue-500 transition-colors" placeholder="e.g., 40" required>
                </div>
                <!-- Carrying Capacity -->
                <div>
                    <label for="carryingCapacity" class="block text-sm font-medium text-gray-700">Carrying Capacity</label>
                    <input type="text" id="carryingCapacity" class="mt-1 p-2 border border-gray-300 rounded-md w-full text-sm bg-gray-200 cursor-not-allowed" value="N/A" readonly>
                </div>
            </div>

            <!-- NCB & Discount Row -->
            <div class="grid grid-cols-2 gap-3">
                <!-- NCB Percentage -->
                <div>
                    <label for="ncb" class="block text-sm font-medium text-gray-700">No Claim Bonus (NCB) %</label>
                    <select id="ncb" class="mt-1 p-2 border border-gray-300 rounded-md w-full text-sm focus:ring-blue-500 focus:border-blue-500 transition-colors" required>
                        <option value="0">0%</option>
                        <option value="20">20%</option>
                        <option value="25">25%</option>
                        <option value="35">35%</option>
                        <option value="45">45%</option>
                        <option value="50">50%</option>
                    </select>
                </div>
                <!-- Company Discount -->
                <div>
                    <label for="companyDiscount" class="block text-sm font-medium text-gray-700">Company Discount</label>
                    <select id="companyDiscount" class="mt-1 p-2 border border-gray-300 rounded-md w-full text-sm focus:ring-blue-500 focus:border-blue-500 transition-colors" required>
                        <option value="none">No Discount</option>
                        <option value="digit">Digit (99%)</option>
                        <option value="tata">TATA AIG (95%)</option>
                        <option value="reliance">Reliance General (95%)</option>
                        <option value="icici">ICICI Lombard (99%)</option>
                    </select>
                </div>
            </div>
            
            <!-- Additional Options Checkboxes & Inputs on one line -->
            <div class="grid grid-cols-2 gap-3">
                <!-- CNG Fuel Type Checkbox -->
                <div>
                    <label for="cngFuel" class="block text-sm font-medium text-gray-700">CNG Fuel Type</label>
                    <input type="checkbox" id="cngFuel" class="h-4 w-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500 mt-1">
                </div>
                <!-- Legal Liability to Paid Driver as an editable field -->
                <div>
                    <label for="llDriver" class="block text-sm font-medium text-gray-700">LL to Paid Driver</label>
                    <input type="number" id="llDriver" class="mt-1 p-2 border border-gray-300 rounded-md w-full text-sm focus:ring-blue-500 focus:border-blue-500 transition-colors" placeholder="e.g., 1">
                </div>
            </div>

            <!-- Calculate Button -->
            <button type="submit" class="w-full bg-blue-600 text-white font-bold py-2 rounded-md text-base hover:bg-blue-700 transition-colors">
                Calculate
            </button>
        </form>

        <!-- Results Section -->
        <div id="results" class="mt-4 hidden">
            <h2 class="text-base font-bold text-gray-800 mb-2">Premium Breakdown</h2>
            <div class="space-y-2 p-3 bg-gray-50 rounded-md border border-gray-200 text-sm">
                <div class="flex justify-between items-center text-gray-600">
                    <span>Own Damage (OD) Premium</span>
                    <span id="odPremium" class="font-semibold text-gray-800"></span>
                </div>
                <div class="flex justify-between items-center text-gray-600">
                    <span>CNG Premium</span>
                    <span id="cngOdPremiumAmount" class="font-semibold text-gray-800"></span>
                </div>
                <div class="flex justify-between items-center text-gray-600">
                    <span>Third-Party (TP) Liability Premium</span>
                    <span id="tpPremium" class="font-semibold text-gray-800"></span>
                </div>
                <div class="flex justify-between items-center text-gray-600">
                    <span>IMT 23</span>
                    <span id="imt23Premium" class="font-semibold text-gray-800"></span>
                </div>
                <div class="flex justify-between items-center text-gray-600">
                    <span>Towing Charge</span>
                    <span id="towingChargePremium" class="font-semibold text-gray-800"></span>
                </div>
                <div class="flex justify-between items-center text-gray-600">
                    <span>CNG TP Premium</span>
                    <span id="cngTpPremiumAmount" class="font-semibold text-gray-800"></span>
                </div>
                <div class="flex justify-between items-center text-gray-600">
                    <span>Legal Liability to Paid Driver</span>
                    <span id="llDriverPremiumAmount" class="font-semibold text-gray-800"></span>
                </div>
                <div class="flex justify-between items-center text-green-600">
                    <span id="companyDiscountLabel">Company Discount</span>
                    <span id="companyDiscountAmount" class="font-semibold">- ₹0.00</span>
                </div>
                <hr class="border-t border-gray-300">
                <div class="flex justify-between items-center text-gray-600 font-semibold text-gray-800">
                    <span>Subtotal Premium (before GST)</span>
                    <span id="subtotalPremium" class="font-semibold text-gray-800"></span>
                </div>
                <div class="flex justify-between items-center text-gray-600 font-semibold text-gray-800">
                    <span>GST (18%)</span>
                    <span id="gstAmount" class="font-semibold text-gray-800"></span>
                </div>
                <hr class="border-t border-gray-300">
                <div class="flex justify-between items-center text-base font-bold text-gray-800">
                    <span>Total Premium (with GST)</span>
                    <span id="totalPremium" class="text-blue-600"></span>
                </div>
            </div>
            
            <!-- Commission Breakdown Toggle Button -->
            <button id="toggleCommissionBtn" class="w-full text-left font-bold text-white mt-3 py-2 px-3 flex justify-between items-center bg-green-600 rounded-md hover:bg-green-700 transition-colors">
                <span>Commission Breakdown</span>
                <span id="commissionToggleIcon">▶</span>
            </button>

            <!-- Generate PDF Button -->
            <button id="generatePdfBtn" class="w-full mt-2 bg-purple-600 text-white font-bold py-2 rounded-md text-base hover:bg-purple-700 transition-colors flex items-center justify-center space-x-2">
                <span id="generatePdfText">Generate PDF</span>
                <div id="generatePdfLoader" class="loader hidden"></div>
            </button>
        </div>
    </div>
    
    <!-- Commission Breakdown Modal -->
    <div id="commissionModal" class="fixed inset-0 bg-gray-800 bg-opacity-75 flex items-center justify-center p-4 z-50 hidden">
        <div class="bg-white p-6 rounded-lg shadow-2xl w-full max-w-sm relative">
            <!-- Modal Header and Close Button -->
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-xl font-bold text-gray-800">Commission Breakdown</h2>
                <button id="closeModalBtn" class="text-gray-500 hover:text-gray-800">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                    </svg>
                </button>
            </div>
            
            <!-- Commission Rate Input within the modal -->
            <div class="mb-4">
                <label for="commissionRate" class="block text-base font-medium text-gray-700">Commission Rate %</label>
                <input type="number" id="commissionRate" value="75" min="0" max="100" class="mt-1 p-2 border border-gray-300 rounded-md w-full text-base focus:ring-green-500 focus:border-green-500 transition-colors" required>
            </div>

            <!-- Commission Results Section -->
            <div id="commissionSection" class="space-y-2 p-3 bg-gray-100 rounded-md border border-gray-300 text-sm">
                <!-- New line to show the premium amount the commission is based on -->
                <div class="flex justify-between items-center text-gray-600">
                    <span>Premium for Commission</span>
                    <span id="premiumForCommission" class="font-semibold text-gray-800"></span>
                </div>
                <div class="flex justify-between items-center text-gray-600">
                    <span>Commission before TDS (<span id="commissionRateDisplay">75</span>% of Premium)</span>
                    <span id="basicCommission" class="font-semibold text-gray-800"></span>
                </div>
                <div class="flex justify-between items-center text-gray-600">
                    <span>TDS on Commission (2%)</span>
                    <span id="tdsOnCommission" class="font-semibold text-gray-800"></span>
                </div>
                <hr class="border-t border-gray-300">
                <div class="flex justify-between items-center text-base font-bold text-gray-800">
                    <span>Net Commission</span>
                    <span id="totalCommission" class="text-green-600"></span>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Custom Message Box Modal -->
    <div id="messageBox" class="fixed inset-0 bg-gray-800 bg-opacity-75 flex items-center justify-center p-4 z-50 hidden">
        <div class="message-box">
            <p id="messageText" class="text-gray-800 text-center mb-4"></p>
            <button id="closeMessageBoxBtn" class="w-full bg-blue-600 text-white font-bold py-2 rounded-md hover:bg-blue-700 transition-colors">OK</button>
        </div>
    </div>

    <!-- PDF Content Area (Hidden by default) -->
    <div id="pdfContent" class="hidden">
        <h1>Premium Breakdown</h1>
        <div class="text-sm my-4">
            <p><strong>Insured Declared Value (IDV):</strong> <span id="pdf-idv"></span></p>
            <p><strong>Seating Capacity:</strong> <span id="pdf-seating-capacity"></span></p>
        </div>
        
        <div class="section-title">Own Damage Premium</div>
        <div class="row">
            <span>Own Damage Premium</span>
            <span id="pdf-od-premium"></span>
        </div>
        <div class="row">
            <span>CNG Premium</span>
            <span id="pdf-cng-od-premium"></span>
        </div>
        <div class="row">
            <span id="pdf-company-discount-label">Company Discount</span>
            <span id="pdf-company-discount-amount"></span>
        </div>
        
        <div class="section-title">Third Party and Other Premiums</div>
        <div class="row">
            <span>Third-Party (TP) Liability Premium</span>
            <span id="pdf-tp-premium"></span>
        </div>
        <div class="row">
            <span>IMT 23</span>
            <span id="pdf-imt23-premium"></span>
        </div>
        <div class="row">
            <span>Towing Charge</span>
            <span id="pdf-towing-charge"></span>
        </div>
        <div class="row">
            <span>CNG TP Premium</span>
            <span id="pdf-cng-tp-premium"></span>
        </div>
        <div class="row">
            <span>Legal Liability to Paid Driver</span>
            <span id="pdf-ll-driver-premium"></span>
        </div>
        
        <div class="section-title">Summary</div>
        <div class="row">
            <span>Subtotal Premium (before GST)</span>
            <span id="pdf-subtotal-premium"></span>
        </div>
        <div class="row">
            <span>GST (18%)</span>
            <span id="pdf-gst-amount"></span>
        </div>
        
        <div class="row total-premium-row">
            <span class="row-total">Total Premium (with GST)</span>
            <span class="row-total" id="pdf-total-premium"></span>
        </div>
    </div>
    
    <!-- JavaScript for Calculations and PDF Generation -->
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const premiumForm = document.getElementById('premiumForm');
            const seatingCapacityInput = document.getElementById('seatingCapacity');
            const carryingCapacityDisplay = document.getElementById('carryingCapacity');
            const resultsSection = document.getElementById('results');
            const messageBox = document.getElementById('messageBox');
            const messageText = document.getElementById('messageText');
            const closeMessageBoxBtn = document.getElementById('closeMessageBoxBtn');

            // Global variable to store calculated data for both display and PDF
            let calculatedData = {};

            function showMessage(text) {
                messageText.textContent = text;
                messageBox.classList.remove('hidden');
            }

            closeMessageBoxBtn.addEventListener('click', () => {
                messageBox.classList.add('hidden');
            });

            const calculateAndDisplayPremium = () => {
                const idv = parseFloat(document.getElementById('idv').value);
                const seatingCapacity = parseInt(seatingCapacityInput.value);
                
                if (seatingCapacity < 8) {
                    showMessage("Seating capacity cannot be less than 8.");
                    return;
                }
                
                const licensedPassengers = seatingCapacity > 0 ? seatingCapacity - 1 : 0;
                const ncb = parseInt(document.getElementById('ncb').value);
                const selectedCompany = document.getElementById('companyDiscount').value;
                const isCngFuel = document.getElementById('cngFuel').checked;
                const llDriverValue = parseFloat(document.getElementById('llDriver').value) || 0;

                carryingCapacityDisplay.value = licensedPassengers;
                
                if (!idv || !seatingCapacity) {
                    resultsSection.classList.add('hidden');
                    return;
                }

                const odRate = 1.739;
                const basicOdPremium = idv * (odRate / 100);

                let loadingPremium;
                if (seatingCapacity <= 19) {
                    loadingPremium = 350;
                } else if (seatingCapacity >= 20 && seatingCapacity <= 37) {
                    loadingPremium = 450;
                } else {
                    loadingPremium = 550;
                }
                
                const cngOdPremiumRate = 0.05;
                let cngOdPremium = isCngFuel ? basicOdPremium * cngOdPremiumRate : 0;
                
                const odPremiumBeforeNcb = basicOdPremium + loadingPremium + cngOdPremium;
                
                const ncbDiscount = odPremiumBeforeNcb * (ncb / 100);
                const odPremiumAfterNcb = odPremiumBeforeNcb - ncbDiscount;
                
                const imt23Rate = 0.15;
                const imt23PremiumBeforeDiscount = odPremiumAfterNcb * imt23Rate;

                let discountRate = 0;
                let discountLabelText = 'Company Discount';
                let towingCharge = 0;
                
                if (selectedCompany === 'digit') {
                    discountRate = 0.99;
                    discountLabelText = 'Digit Discount (99%)';
                } else if (selectedCompany === 'tata') {
                    discountRate = 0.95;
                    discountLabelText = 'TATA AIG Discount (95%)';
                } else if (selectedCompany === 'reliance') {
                    discountRate = 0.95;
                    discountLabelText = 'Reliance General Discount (95%)';
                    towingCharge = 500;
                } else if (selectedCompany === 'icici') {
                    discountRate = 0.99;
                    discountLabelText = 'ICICI Lombard Discount (99%)';
                    towingCharge = 0;
                }

                const odPremiumAfterCompanyDiscount = odPremiumAfterNcb * (1 - discountRate);
                const imt23PremiumAfterCompanyDiscount = imt23PremiumBeforeDiscount * (1 - discountRate);
                const cngOdPremiumAfterDiscount = isCngFuel ? cngOdPremium * (1 - discountRate) : 0;

                const companyDiscountAmount = (odPremiumAfterNcb + imt23PremiumBeforeDiscount + cngOdPremium) * discountRate;

                const basicTpPremium = 12192;
                const licensedPassengerPremium = licensedPassengers * 745;
                const totalTpPremium = basicTpPremium + licensedPassengerPremium;
                
                let cngTpPremium = isCngFuel ? 60 : 0;
                let llDriverPremium = llDriverValue > 0 ? (llDriverValue === 1 ? 50 : (llDriverValue === 2 ? 100 : llDriverValue * licensedPassengers)) : 0;
                
                const totalPremiumBeforeGst = odPremiumAfterCompanyDiscount + imt23PremiumAfterCompanyDiscount + totalTpPremium + towingCharge + cngTpPremium + cngOdPremiumAfterDiscount + llDriverPremium;
                
                const gstAmount = totalPremiumBeforeGst * 0.18;
                const finalTotalPremiumWithGst = totalPremiumBeforeGst + gstAmount;

                // Update the global calculatedData object
                calculatedData = {
                    idv,
                    seatingCapacity,
                    licensedPassengers,
                    odPremiumAfterCompanyDiscount,
                    cngOdPremiumAfterDiscount,
                    totalTpPremium,
                    imt23PremiumAfterCompanyDiscount,
                    towingCharge,
                    cngTpPremium,
                    llDriverPremium,
                    companyDiscountLabel: discountLabelText,
                    companyDiscountAmount,
                    subtotalPremium: totalPremiumBeforeGst,
                    gstAmount,
                    totalPremium: finalTotalPremiumWithGst,
                };

                // Display all breakdown lines, even if zero
                document.getElementById('odPremium').textContent = formatCurrency(calculatedData.odPremiumAfterCompanyDiscount);
                document.getElementById('cngOdPremiumAmount').textContent = formatCurrency(calculatedData.cngOdPremiumAfterDiscount);
                document.getElementById('tpPremium').textContent = formatCurrency(calculatedData.totalTpPremium);
                document.getElementById('imt23Premium').textContent = formatCurrency(calculatedData.imt23PremiumAfterCompanyDiscount);
                document.getElementById('towingChargePremium').textContent = formatCurrency(calculatedData.towingCharge);
                document.getElementById('cngTpPremiumAmount').textContent = formatCurrency(calculatedData.cngTpPremium);
                document.getElementById('llDriverPremiumAmount').textContent = formatCurrency(calculatedData.llDriverPremium);
                document.getElementById('companyDiscountLabel').textContent = calculatedData.companyDiscountLabel;
                document.getElementById('companyDiscountAmount').textContent = formatCurrency(calculatedData.companyDiscountAmount, true);
                
                document.getElementById('subtotalPremium').textContent = formatCurrency(calculatedData.subtotalPremium);
                document.getElementById('gstAmount').textContent = formatCurrency(calculatedData.gstAmount);
                document.getElementById('totalPremium').textContent = formatCurrency(calculatedData.totalPremium);

                resultsSection.classList.remove('hidden');
            };

            const calculateAndDisplayCommission = () => {
                const totalPremiumBeforeGst = calculatedData?.subtotalPremium || 0;
                const commissionRateInput = parseFloat(document.getElementById('commissionRate').value);
                
                if (isNaN(totalPremiumBeforeGst) || totalPremiumBeforeGst === 0) {
                     document.getElementById('premiumForCommission').textContent = formatCurrency(0);
                     document.getElementById('basicCommission').textContent = formatCurrency(0);
                     document.getElementById('tdsOnCommission').textContent = formatCurrency(0);
                     document.getElementById('totalCommission').textContent = formatCurrency(0);
                     return;
                }
                
                const commissionRate = commissionRateInput / 100;
                const basicCommission = totalPremiumBeforeGst * commissionRate;
                const tdsRate = 0.02;
                const tdsOnCommission = basicCommission * tdsRate;
                const totalCommission = basicCommission - tdsOnCommission;
                
                document.getElementById('premiumForCommission').textContent = formatCurrency(totalPremiumBeforeGst);
                document.getElementById('commissionRateDisplay').textContent = commissionRateInput;
                document.getElementById('basicCommission').textContent = formatCurrency(basicCommission);
                document.getElementById('tdsOnCommission').textContent = formatCurrency(tdsOnCommission);
                document.getElementById('totalCommission').textContent = formatCurrency(totalCommission);
            };

            premiumForm.addEventListener('submit', function(event) {
                event.preventDefault();
                calculateAndDisplayPremium();
            });

            seatingCapacityInput.addEventListener('input', function() {
                const seatingCapacity = parseInt(this.value);
                const licensedPassengers = seatingCapacity > 0 ? seatingCapacity - 1 : 0;
                carryingCapacityDisplay.value = licensedPassengers > 0 ? licensedPassengers : "N/A";
            });

            const toggleCommissionBtn = document.getElementById('toggleCommissionBtn');
            const commissionModal = document.getElementById('commissionModal');
            const closeModalBtn = document.getElementById('closeModalBtn');
            const commissionRateInput = document.getElementById('commissionRate');

            toggleCommissionBtn.addEventListener('click', function() {
                if (!Object.keys(calculatedData).length) {
                     showMessage("Please calculate the premium first.");
                     return;
                }
                commissionModal.classList.remove('hidden');
                calculateAndDisplayCommission();
            });

            closeModalBtn.addEventListener('click', function() {
                commissionModal.classList.add('hidden');
            });
            
            commissionRateInput.addEventListener('input', calculateAndDisplayCommission);

            const generatePdfBtn = document.getElementById('generatePdfBtn');
            const generatePdfText = document.getElementById('generatePdfText');
            const generatePdfLoader = document.getElementById('generatePdfLoader');
            const pdfContent = document.getElementById('pdfContent');
            
            generatePdfBtn.addEventListener('click', () => {
                if (!Object.keys(calculatedData).length) {
                    showMessage("Please calculate the premium first.");
                    return;
                }
                
                // Update the PDF content with the calculated data
                document.getElementById('pdf-idv').textContent = formatCurrency(calculatedData.idv);
                document.getElementById('pdf-seating-capacity').textContent = calculatedData.seatingCapacity;
                document.getElementById('pdf-od-premium').textContent = formatCurrency(calculatedData.odPremiumAfterCompanyDiscount);
                document.getElementById('pdf-cng-od-premium').textContent = formatCurrency(calculatedData.cngOdPremiumAfterDiscount);
                document.getElementById('pdf-company-discount-label').textContent = calculatedData.companyDiscountLabel;
                document.getElementById('pdf-company-discount-amount').textContent = formatCurrency(calculatedData.companyDiscountAmount, true);
                document.getElementById('pdf-tp-premium').textContent = formatCurrency(calculatedData.totalTpPremium);
                document.getElementById('pdf-imt23-premium').textContent = formatCurrency(calculatedData.imt23PremiumAfterCompanyDiscount);
                document.getElementById('pdf-towing-charge').textContent = formatCurrency(calculatedData.towingCharge);
                document.getElementById('pdf-cng-tp-premium').textContent = formatCurrency(calculatedData.cngTpPremium);
                document.getElementById('pdf-ll-driver-premium').textContent = formatCurrency(calculatedData.llDriverPremium);
                document.getElementById('pdf-subtotal-premium').textContent = formatCurrency(calculatedData.subtotalPremium);
                document.getElementById('pdf-gst-amount').textContent = formatCurrency(calculatedData.gstAmount);
                document.getElementById('pdf-total-premium').textContent = formatCurrency(calculatedData.totalPremium);

                // Temporarily disable the button and show loading state
                generatePdfBtn.disabled = true;
                generatePdfText.textContent = 'Generating...';
                generatePdfLoader.classList.remove('hidden');
                
                // Use a short delay to allow the DOM to update before printing
                setTimeout(() => {
                    window.print();
                    
                    // Re-enable the button and hide loading state after printing
                    generatePdfBtn.disabled = false;
                    generatePdfText.textContent = 'Generate PDF';
                    generatePdfLoader.classList.add('hidden');
                }, 500);
            });
        });

        // Helper function to format numbers as Indian Rupees
        function formatCurrency(amount, isDiscount = false) {
            const formatter = new Intl.NumberFormat('en-IN', {
                style: 'currency',
                currency: 'INR',
                minimumFractionDigits: 2,
            });

            if (isDiscount) {
                return `- ${formatter.format(amount).replace('₹', '')}`;
            } else {
                return formatter.format(amount);
            }
        }
    

// --- School Bus Calculator Logic ---

        document.addEventListener('DOMContentLoaded', () => {
            const premiumForm = document.getElementById('premiumForm');
            const seatingCapacityInput = document.getElementById('seatingCapacity');
            const carryingCapacityDisplay = document.getElementById('carryingCapacity');
            const resultsSection = document.getElementById('results');
            const messageBox = document.getElementById('messageBox');
            const messageText = document.getElementById('messageText');
            const closeMessageBoxBtn = document.getElementById('closeMessageBoxBtn');

            // Global variable to store calculated data for both display and PDF
            let calculatedData = {};

            function showMessage(text) {
                messageText.textContent = text;
                messageBox.classList.remove('hidden');
            }

            closeMessageBoxBtn.addEventListener('click', () => {
                messageBox.classList.add('hidden');
            });

            const calculateAndDisplayPremium = () => {
                const idv = parseFloat(document.getElementById('idv').value);
                const seatingCapacity = parseInt(seatingCapacityInput.value);
                
                if (seatingCapacity < 8) {
                    showMessage("Seating capacity cannot be less than 8.");
                    return;
                }
                
                const licensedPassengers = seatingCapacity > 0 ? seatingCapacity - 1 : 0;
                const ncb = parseInt(document.getElementById('ncb').value);
                const selectedCompany = document.getElementById('companyDiscount').value;
                const isCngFuel = document.getElementById('cngFuel').checked;
                const llDriverValue = parseFloat(document.getElementById('llDriver').value) || 0;

                carryingCapacityDisplay.value = licensedPassengers;
                
                if (!idv || !seatingCapacity) {
                    resultsSection.classList.add('hidden');
                    return;
                }

                const odRate = 1.739;
                const basicOdPremium = idv * (odRate / 100);

                let loadingPremium;
                if (seatingCapacity <= 19) {
                    loadingPremium = 350;
                } else if (seatingCapacity >= 20 && seatingCapacity <= 37) {
                    loadingPremium = 450;
                } else {
                    loadingPremium = 550;
                }
                
                const cngOdPremiumRate = 0.05;
                let cngOdPremium = isCngFuel ? basicOdPremium * cngOdPremiumRate : 0;
                
                const odPremiumBeforeNcb = basicOdPremium + loadingPremium + cngOdPremium;
                
                const ncbDiscount = odPremiumBeforeNcb * (ncb / 100);
                const odPremiumAfterNcb = odPremiumBeforeNcb - ncbDiscount;
                
                const imt23Rate = 0.15;
                const imt23PremiumBeforeDiscount = odPremiumAfterNcb * imt23Rate;

                let discountRate = 0;
                let discountLabelText = 'Company Discount';
                let towingCharge = 0;
                
                if (selectedCompany === 'digit') {
                    discountRate = 0.99;
                    discountLabelText = 'Digit Discount (99%)';
                } else if (selectedCompany === 'tata') {
                    discountRate = 0.95;
                    discountLabelText = 'TATA AIG Discount (95%)';
                } else if (selectedCompany === 'reliance') {
                    discountRate = 0.95;
                    discountLabelText = 'Reliance General Discount (95%)';
                    towingCharge = 500;
                } else if (selectedCompany === 'icici') {
                    discountRate = 0.99;
                    discountLabelText = 'ICICI Lombard Discount (99%)';
                    towingCharge = 0;
                }

                const odPremiumAfterCompanyDiscount = odPremiumAfterNcb * (1 - discountRate);
                const imt23PremiumAfterCompanyDiscount = imt23PremiumBeforeDiscount * (1 - discountRate);
                const cngOdPremiumAfterDiscount = isCngFuel ? cngOdPremium * (1 - discountRate) : 0;

                const companyDiscountAmount = (odPremiumAfterNcb + imt23PremiumBeforeDiscount + cngOdPremium) * discountRate;

                const basicTpPremium = 12192;
                const licensedPassengerPremium = licensedPassengers * 745;
                const totalTpPremium = basicTpPremium + licensedPassengerPremium;
                
                let cngTpPremium = isCngFuel ? 60 : 0;
                let llDriverPremium = llDriverValue > 0 ? (llDriverValue === 1 ? 50 : (llDriverValue === 2 ? 100 : llDriverValue * licensedPassengers)) : 0;
                
                const totalPremiumBeforeGst = odPremiumAfterCompanyDiscount + imt23PremiumAfterCompanyDiscount + totalTpPremium + towingCharge + cngTpPremium + cngOdPremiumAfterDiscount + llDriverPremium;
                
                const gstAmount = totalPremiumBeforeGst * 0.18;
                const finalTotalPremiumWithGst = totalPremiumBeforeGst + gstAmount;

                // Update the global calculatedData object
                calculatedData = {
                    idv,
                    seatingCapacity,
                    licensedPassengers,
                    odPremiumAfterCompanyDiscount,
                    cngOdPremiumAfterDiscount,
                    totalTpPremium,
                    imt23PremiumAfterCompanyDiscount,
                    towingCharge,
                    cngTpPremium,
                    llDriverPremium,
                    companyDiscountLabel: discountLabelText,
                    companyDiscountAmount,
                    subtotalPremium: totalPremiumBeforeGst,
                    gstAmount,
                    totalPremium: finalTotalPremiumWithGst,
                };

                // Display all breakdown lines, even if zero
                document.getElementById('odPremium').textContent = formatCurrency(calculatedData.odPremiumAfterCompanyDiscount);
                document.getElementById('cngOdPremiumAmount').textContent = formatCurrency(calculatedData.cngOdPremiumAfterDiscount);
                document.getElementById('tpPremium').textContent = formatCurrency(calculatedData.totalTpPremium);
                document.getElementById('imt23Premium').textContent = formatCurrency(calculatedData.imt23PremiumAfterCompanyDiscount);
                document.getElementById('towingChargePremium').textContent = formatCurrency(calculatedData.towingCharge);
                document.getElementById('cngTpPremiumAmount').textContent = formatCurrency(calculatedData.cngTpPremium);
                document.getElementById('llDriverPremiumAmount').textContent = formatCurrency(calculatedData.llDriverPremium);
                document.getElementById('companyDiscountLabel').textContent = calculatedData.companyDiscountLabel;
                document.getElementById('companyDiscountAmount').textContent = formatCurrency(calculatedData.companyDiscountAmount, true);
                
                document.getElementById('subtotalPremium').textContent = formatCurrency(calculatedData.subtotalPremium);
                document.getElementById('gstAmount').textContent = formatCurrency(calculatedData.gstAmount);
                document.getElementById('totalPremium').textContent = formatCurrency(calculatedData.totalPremium);

                resultsSection.classList.remove('hidden');
            };

            const calculateAndDisplayCommission = () => {
                const totalPremiumBeforeGst = calculatedData?.subtotalPremium || 0;
                const commissionRateInput = parseFloat(document.getElementById('commissionRate').value);
                
                if (isNaN(totalPremiumBeforeGst) || totalPremiumBeforeGst === 0) {
                     document.getElementById('premiumForCommission').textContent = formatCurrency(0);
                     document.getElementById('basicCommission').textContent = formatCurrency(0);
                     document.getElementById('tdsOnCommission').textContent = formatCurrency(0);
                     document.getElementById('totalCommission').textContent = formatCurrency(0);
                     return;
                }
                
                const commissionRate = commissionRateInput / 100;
                const basicCommission = totalPremiumBeforeGst * commissionRate;
                const tdsRate = 0.02;
                const tdsOnCommission = basicCommission * tdsRate;
                const totalCommission = basicCommission - tdsOnCommission;
                
                document.getElementById('premiumForCommission').textContent = formatCurrency(totalPremiumBeforeGst);
                document.getElementById('commissionRateDisplay').textContent = commissionRateInput;
                document.getElementById('basicCommission').textContent = formatCurrency(basicCommission);
                document.getElementById('tdsOnCommission').textContent = formatCurrency(tdsOnCommission);
                document.getElementById('totalCommission').textContent = formatCurrency(totalCommission);
            };

            premiumForm.addEventListener('submit', function(event) {
                event.preventDefault();
                calculateAndDisplayPremium();
            });

            seatingCapacityInput.addEventListener('input', function() {
                const seatingCapacity = parseInt(this.value);
                const licensedPassengers = seatingCapacity > 0 ? seatingCapacity - 1 : 0;
                carryingCapacityDisplay.value = licensedPassengers > 0 ? licensedPassengers : "N/A";
            });

            const toggleCommissionBtn = document.getElementById('toggleCommissionBtn');
            const commissionModal = document.getElementById('commissionModal');
            const closeModalBtn = document.getElementById('closeModalBtn');
            const commissionRateInput = document.getElementById('commissionRate');

            toggleCommissionBtn.addEventListener('click', function() {
                if (!Object.keys(calculatedData).length) {
                     showMessage("Please calculate the premium first.");
                     return;
                }
                commissionModal.classList.remove('hidden');
                calculateAndDisplayCommission();
            });

            closeModalBtn.addEventListener('click', function() {
                commissionModal.classList.add('hidden');
            });
            
            commissionRateInput.addEventListener('input', calculateAndDisplayCommission);

            const generatePdfBtn = document.getElementById('generatePdfBtn');
            const generatePdfText = document.getElementById('generatePdfText');
            const generatePdfLoader = document.getElementById('generatePdfLoader');
            const pdfContent = document.getElementById('pdfContent');
            
            generatePdfBtn.addEventListener('click', () => {
                if (!Object.keys(calculatedData).length) {
                    showMessage("Please calculate the premium first.");
                    return;
                }
                
                // Update the PDF content with the calculated data
                document.getElementById('pdf-idv').textContent = formatCurrency(calculatedData.idv);
                document.getElementById('pdf-seating-capacity').textContent = calculatedData.seatingCapacity;
                document.getElementById('pdf-od-premium').textContent = formatCurrency(calculatedData.odPremiumAfterCompanyDiscount);
                document.getElementById('pdf-cng-od-premium').textContent = formatCurrency(calculatedData.cngOdPremiumAfterDiscount);
                document.getElementById('pdf-company-discount-label').textContent = calculatedData.companyDiscountLabel;
                document.getElementById('pdf-company-discount-amount').textContent = formatCurrency(calculatedData.companyDiscountAmount, true);
                document.getElementById('pdf-tp-premium').textContent = formatCurrency(calculatedData.totalTpPremium);
                document.getElementById('pdf-imt23-premium').textContent = formatCurrency(calculatedData.imt23PremiumAfterCompanyDiscount);
                document.getElementById('pdf-towing-charge').textContent = formatCurrency(calculatedData.towingCharge);
                document.getElementById('pdf-cng-tp-premium').textContent = formatCurrency(calculatedData.cngTpPremium);
                document.getElementById('pdf-ll-driver-premium').textContent = formatCurrency(calculatedData.llDriverPremium);
                document.getElementById('pdf-subtotal-premium').textContent = formatCurrency(calculatedData.subtotalPremium);
                document.getElementById('pdf-gst-amount').textContent = formatCurrency(calculatedData.gstAmount);
                document.getElementById('pdf-total-premium').textContent = formatCurrency(calculatedData.totalPremium);

                // Temporarily disable the button and show loading state
                generatePdfBtn.disabled = true;
                generatePdfText.textContent = 'Generating...';
                generatePdfLoader.classList.remove('hidden');
                
                // Use a short delay to allow the DOM to update before printing
                setTimeout(() => {
                    window.print();
                    
                    // Re-enable the button and hide loading state after printing
                    generatePdfBtn.disabled = false;
                    generatePdfText.textContent = 'Generate PDF';
                    generatePdfLoader.classList.add('hidden');
                }, 500);
            });
        });

        // Helper function to format numbers as Indian Rupees
        function formatCurrency(amount, isDiscount = false) {
            const formatter = new Intl.NumberFormat('en-IN', {
                style: 'currency',
                currency: 'INR',
                minimumFractionDigits: 2,
            });

            if (isDiscount) {
                return `- ${formatter.format(amount).replace('₹', '')}`;
            } else {
                return formatter.format(amount);
            }
        }
    
</script>

            </div>
<div id="vahan-section" class="tab-content w-full max-w-lg p-4 sm:p-6 bg-gray-50 rounded-2xl shadow-inner border border-gray-100 transition-all duration-300 transform scale-100 hidden">
                <h2 class="text-2xl font-bold text-center text-indigo-600 mb-4">Vahan Data</h2>
                <p class="text-center text-gray-500 mb-6">Access key vehicle and claim links instantly.</p>
                
                <div class="flex flex-col space-y-4">
                    <button id="vahanLink" class="w-full py-3 px-4 rounded-xl font-semibold text-white shadow-lg bg-indigo-500 hover:bg-indigo-600 transition-all duration-300 transform hover:scale-105">
                        Vehicle Details
                    </button>
                    <button id="claimLink" class="w-full py-3 px-4 rounded-xl font-semibold text-white shadow-lg bg-indigo-500 hover:bg-indigo-600 transition-all duration-300 transform hover:scale-105">
                        Claim Details
                    </button>
                    <button id="iibLink" class="w-full py-3 px-4 rounded-xl font-semibold text-white shadow-lg bg-indigo-500 hover:bg-indigo-600 transition-all duration-300 transform hover:scale-105">
                        Insurance Details
                    </button>
                </div>
            </div>

        </div> </div>
    
    <div id="idv-modal" class="fixed inset-0 z-50 hidden overflow-y-auto bg-gray-600 bg-opacity-50">
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="bg-white rounded-lg shadow-xl p-6 sm:p-8 w-full max-w-sm relative transform scale-95 transition-transform duration-300">
                <h3 class="text-xl font-bold text-indigo-700 mb-4 text-center">Calculated IDV</h3>
                <p id="idv-modal-result" class="text-2xl font-extrabold text-green-600 text-center mb-6"></p>
                <div class="text-center">
                    <button id="close-idv-modal" class="px-6 py-2 bg-indigo-500 text-white rounded-md hover:bg-indigo-600 focus:outline-none">
                        Close
                    </button>
                </div>
            </div>
        </div>
    </div>

    <div id="depreciation-modal" class="fixed inset-0 z-50 hidden overflow-y-auto bg-gray-600 bg-opacity-50">
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="bg-white rounded-lg shadow-xl p-6 sm:p-8 w-full max-w-md relative transform scale-95 transition-transform duration-300">
                <h3 class="text-xl font-bold text-indigo-700 mb-4 text-center">Depreciation Results</h3>
                <div id="depreciation-modal-result" class="space-y-4"></div>
                <div class="text-center mt-6">
                    <button id="close-depreciation-modal" class="px-6 py-2 bg-indigo-500 text-white rounded-md hover:bg-indigo-600 focus:outline-none">
                        Close
                    </button>
                </div>
            </div>
        </div>
    </div>

    <div id="commission-modal" class="fixed inset-0 z-50 hidden overflow-y-auto bg-gray-600 bg-opacity-50">
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="bg-white rounded-lg shadow-xl p-6 sm:p-8 w-full max-w-md relative transform scale-95 transition-transform duration-300">
                <h3 class="text-xl font-bold text-indigo-700 mb-4 text-center">Commission Details</h3>
                <div id="commission-modal-result" class="space-y-4"></div>
                <div class="text-center mt-6">
                    <button id="close-commission-modal" class="px-6 py-2 bg-indigo-500 text-white rounded-md hover:bg-indigo-600 focus:outline-none">
                        Close
                    </button>
                </div>
            </div>
        </div>
    </div>

    <div id="cutpay-modal" class="fixed inset-0 z-50 hidden overflow-y-auto bg-gray-600 bg-opacity-50">
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="bg-white rounded-lg shadow-xl p-6 sm:p-8 w-full max-w-sm relative transform scale-95 transition-transform duration-300">
                <h3 class="text-xl font-bold text-indigo-700 mb-4 text-center">Cut Pay Result</h3>
                <p id="cutpay-modal-result" class="text-2xl font-extrabold text-green-600 text-center mb-6"></p>
                <div class="text-center mt-6">
                    <button id="close-cutpay-modal" class="px-6 py-2 bg-indigo-500 text-white rounded-md hover:bg-indigo-600 focus:outline-none">
                        Close
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <div id="tds-warning-modal" class="fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50 hidden">
        <div class="bg-white p-6 rounded-xl shadow-2xl max-w-sm w-full mx-4 transform transition-all duration-300 scale-95">
            <div class="text-center">
                <svg class="mx-auto h-12 w-12 text-yellow-500" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />
                </svg>
                <h3 class="mt-2 text-lg font-bold text-gray-900">TDS Rate Warning</h3>
                <div class="mt-2">
                    <p class="text-sm text-gray-500">The default TDS rate is 2%. Please verify the current government rate before editing this field to ensure accuracy.</p>
                </div>
            </div>
            <div class="mt-5 sm:mt-6">
                <button id="close-tds-warning" type="button" class="w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-yellow-500 text-base font-medium text-white hover:bg-yellow-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-yellow-500 sm:text-sm">
                    I Understand
                </button>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // --- Tab Switching Logic ---
            const tabButtons = document.querySelectorAll('.tab-button');
            const tabContents = document.querySelectorAll('.tab-content');

            // Function to show a specific tab and update button styling
            const showTab = (tabId) => {
                tabContents.forEach(content => content.classList.add('hidden'));
                tabButtons.forEach(button => {
                    button.classList.remove('text-indigo-600', 'border-indigo-500');
                    button.classList.add('text-gray-700', 'border-transparent');
                });
                
                document.getElementById(tabId + '-section').classList.remove('hidden');
                document.getElementById('tab-' + tabId).classList.add('text-indigo-600', 'border-indigo-500');
            };

            // Event listeners for tab buttons
            tabButtons.forEach(button => {
                button.addEventListener('click', () => {
                    const tabId = button.id.replace('tab-', '');
                    showTab(tabId);
                });
            });

            // Set initial active tab on page load
            showTab('idv');
            
            // --- IDV Calculator Logic ---
            const idvForm = document.getElementById('idv-form');
            const idvModal = document.getElementById('idv-modal');
            const idvModalResult = document.getElementById('idv-modal-result');
            const closeIdvModalBtn = document.getElementById('close-idv-modal');

            idvForm.addEventListener('submit', (event) => {
                event.preventDefault();
                const initialValue = parseFloat(document.getElementById('initial-value').value);
                const mfgYear = parseInt(document.getElementById('mfg-year').value);
                const currentYear = new Date().getFullYear();
                const depreciationRate = 0.10;

                if (isNaN(initialValue) || initialValue <= 0) {
                    alert("Please enter a valid positive value for the vehicle purchase amount.");
                    return;
                }
                if (isNaN(mfgYear) || mfgYear > currentYear) {
                    alert("Manufacturing year cannot be in the future.");
                    return;
                }

                const yearsElapsed = currentYear - mfgYear;
                const currentValue = initialValue * Math.pow(1 - depreciationRate, yearsElapsed);
                
                idvModalResult.textContent = `₹ ${Math.round(currentValue).toLocaleString('en-IN')}`;
                idvModal.classList.remove('hidden');
            });

            closeIdvModalBtn.addEventListener('click', () => {
                idvModal.classList.add('hidden');
            });


            // --- Depreciation Calculator Logic ---
            const depreciationForm = document.getElementById('depreciation-form');
            const depreciationModal = document.getElementById('depreciation-modal');
            const depreciationModalResult = document.getElementById('depreciation-modal-result');
            const closeDepreciationModalBtn = document.getElementById('close-depreciation-modal');

            depreciationForm.addEventListener('submit', (event) => {
                event.preventDefault();
                const assetValue = parseFloat(document.getElementById('dep-initial-value').value);

                if (isNaN(assetValue) || assetValue <= 0) {
                    alert("Please enter a valid asset value.");
                    return;
                }

                const remaining5 = assetValue * (1 - 0.05);
                const remaining10 = assetValue * (1 - 0.10);

                depreciationModalResult.innerHTML = `
                    <div class="space-y-3">
                        <div class="flex justify-between items-center p-3 bg-white rounded-md border">
                            <span class="text-gray-600">After 5% Depreciation:</span>
                            <span class="font-bold text-lg text-emerald-600">₹ ${remaining5.toLocaleString('en-IN')}</span>
                        </div>
                        <div class="flex justify-between items-center p-3 bg-white rounded-md border">
                            <span class="text-gray-600">After 10% Depreciation:</span>
                            <span class="font-bold text-lg text-emerald-600">₹ ${remaining10.toLocaleString('en-IN')}</span>
                        </div>
                    </div>
                `;
                depreciationModal.classList.remove('hidden');
            });

            closeDepreciationModalBtn.addEventListener('click', () => {
                depreciationModal.classList.add('hidden');
            });


            // --- Commission Calculator Logic ---
            const commissionForm = document.getElementById('commission-form');
            const commissionModal = document.getElementById('commission-modal');
            const commissionModalResult = document.getElementById('commission-modal-result');
            const closeCommissionModalBtn = document.getElementById('close-commission-modal');

            commissionForm.addEventListener('submit', (event) => {
                event.preventDefault();
                const odPremium = parseFloat(document.getElementById('odPremium').value) || 0;
                const odRate = parseFloat(document.getElementById('odCommissionRate').value) || 0;
                const tpPremium = parseFloat(document.getElementById('tpPremium').value) || 0;
                const tpRate = parseFloat(document.getElementById('tpCommissionRate').value) || 0;
                const tdsRate = parseFloat(document.getElementById('tdsRate').value) || 0;
                
                if (odPremium < 0 || odRate < 0 || tpPremium < 0 || tpRate < 0 || tdsRate < 0) {
                    alert("Please enter non-negative values.");
                    return;
                }

                const odCommission = odPremium * (odRate / 100);
                const tpCommission = tpPremium * (tpRate / 100);
                const totalCommission = odCommission + tpCommission;
                const tdsAmount = totalCommission * (tdsRate / 100);    
                const netCommission = totalCommission - tdsAmount;

                commissionModalResult.innerHTML = `
                    <div class="space-y-3">
                        <div class="flex justify-between items-center text-lg">
                            <span class="text-gray-600">Total Commission</span>
                            <span class="font-bold text-gray-800">₹ ${totalCommission.toFixed(2)}</span>
                        </div>
                        <div class="flex justify-between items-center text-lg">
                            <span class="text-gray-600">TDS Deduction (${tdsRate}%)</span>
                            <span class="font-bold text-red-500">- ₹ ${tdsAmount.toFixed(2)}</span>
                        </div>
                        <div class="flex justify-between items-center pt-2 border-t border-gray-300">
                            <strong class="text-lg text-gray-800">Net Commission Payable</strong>
                            <strong class="text-2xl text-green-600">₹ ${netCommission.toFixed(2)}</strong>
                        </div>
                    </div>
                `;
                commissionModal.classList.remove('hidden');
            });

            closeCommissionModalBtn.addEventListener('click', () => {
                commissionModal.classList.add('hidden');
            });
            
            // --- Cut Pay Calculator Logic ---
            const cutpayForm = document.getElementById('cutpay-form');
            const cutpayModal = document.getElementById('cutpay-modal');
            const cutpayModalResult = document.getElementById('cutpay-modal-result');
            const closeCutpayModalBtn = document.getElementById('close-cutpay-modal');

            cutpayForm.addEventListener('submit', (event) => {
                event.preventDefault();
                const b = parseFloat(document.getElementById("cutpay-total-premium").value);
                const d = parseFloat(document.getElementById("cutpay-cut-rate").value);

                if (isNaN(b) || isNaN(d) || b < 0 || d < 0) {
                    alert("Please enter valid, non-negative numbers for Total premium and Cut Rate.");
                    return;
                }

                const c = b / 1.18;
                const e = c * (1 - d / 100);
                const result = e + (b - c);
                
                cutpayModalResult.innerHTML = `₹ ${result.toFixed(2)}`;
                cutpayModal.classList.remove('hidden');
            });

            closeCutpayModalBtn.addEventListener('click', () => {
                cutpayModal.classList.add('hidden');
            });

            // --- Vahan Link Logic ---
            const links = {
                vahan: "https://shrigenservice.shriramgi.com/PreinspectionApp/GIM.PREINSPECTION/PI_IIB_PopUpWindow.aspx?id=vahan",
                claim: "https://shrigenservice.shriramgi.com/PreinspectionApp/GIM.PREINSPECTION/PI_IIB_PopUpWindow.aspx?id=claim",
                iib: "https://shrigenservice.shriramgi.com/PreinspectionApp/GIM.PREINSPECTION/PI_IIB_PopUpWindow.aspx?id=iib"
            };

            const openPopupWindow = (url) => {
                window.open(url, '_blank', 'width=800,height=600,noopener,noreferrer');
            };

            document.getElementById('vahanLink').addEventListener('click', () => openPopupWindow(links.vahan));
            document.getElementById('claimLink').addEventListener('click', () => openPopupWindow(links.claim));
            document.getElementById('iibLink').addEventListener('click', () => openPopupWindow(links.iib));

            // --- New TDS Warning Modal Logic ---
            let tdsWarningShown = false; // Flag to ensure the warning only shows once per session
            const tdsRateInput = document.getElementById('tdsRate');
            const tdsWarningModal = document.getElementById('tds-warning-modal');
            const closeTdsWarningBtn = document.getElementById('close-tds-warning');

            // Show the modal when the TDS input field is focused for the first time
            tdsRateInput.addEventListener('focus', () => {
                if (!tdsWarningShown) {
                    tdsWarningModal.classList.remove('hidden');
                    tdsWarningModal.querySelector('.scale-95').classList.add('scale-100');
                    tdsWarningShown = true;
                }
            });

            // Hide the modal when the "I Understand" button is clicked
            closeTdsWarningBtn.addEventListener('click', () => {
                tdsWarningModal.classList.add('hidden');
                tdsWarningModal.querySelector('.scale-100').classList.remove('scale-100');
            });
        });
    

// --- School Bus Calculator Logic ---

        document.addEventListener('DOMContentLoaded', () => {
            const premiumForm = document.getElementById('premiumForm');
            const seatingCapacityInput = document.getElementById('seatingCapacity');
            const carryingCapacityDisplay = document.getElementById('carryingCapacity');
            const resultsSection = document.getElementById('results');
            const messageBox = document.getElementById('messageBox');
            const messageText = document.getElementById('messageText');
            const closeMessageBoxBtn = document.getElementById('closeMessageBoxBtn');

            // Global variable to store calculated data for both display and PDF
            let calculatedData = {};

            function showMessage(text) {
                messageText.textContent = text;
                messageBox.classList.remove('hidden');
            }

            closeMessageBoxBtn.addEventListener('click', () => {
                messageBox.classList.add('hidden');
            });

            const calculateAndDisplayPremium = () => {
                const idv = parseFloat(document.getElementById('idv').value);
                const seatingCapacity = parseInt(seatingCapacityInput.value);
                
                if (seatingCapacity < 8) {
                    showMessage("Seating capacity cannot be less than 8.");
                    return;
                }
                
                const licensedPassengers = seatingCapacity > 0 ? seatingCapacity - 1 : 0;
                const ncb = parseInt(document.getElementById('ncb').value);
                const selectedCompany = document.getElementById('companyDiscount').value;
                const isCngFuel = document.getElementById('cngFuel').checked;
                const llDriverValue = parseFloat(document.getElementById('llDriver').value) || 0;

                carryingCapacityDisplay.value = licensedPassengers;
                
                if (!idv || !seatingCapacity) {
                    resultsSection.classList.add('hidden');
                    return;
                }

                const odRate = 1.739;
                const basicOdPremium = idv * (odRate / 100);

                let loadingPremium;
                if (seatingCapacity <= 19) {
                    loadingPremium = 350;
                } else if (seatingCapacity >= 20 && seatingCapacity <= 37) {
                    loadingPremium = 450;
                } else {
                    loadingPremium = 550;
                }
                
                const cngOdPremiumRate = 0.05;
                let cngOdPremium = isCngFuel ? basicOdPremium * cngOdPremiumRate : 0;
                
                const odPremiumBeforeNcb = basicOdPremium + loadingPremium + cngOdPremium;
                
                const ncbDiscount = odPremiumBeforeNcb * (ncb / 100);
                const odPremiumAfterNcb = odPremiumBeforeNcb - ncbDiscount;
                
                const imt23Rate = 0.15;
                const imt23PremiumBeforeDiscount = odPremiumAfterNcb * imt23Rate;

                let discountRate = 0;
                let discountLabelText = 'Company Discount';
                let towingCharge = 0;
                
                if (selectedCompany === 'digit') {
                    discountRate = 0.99;
                    discountLabelText = 'Digit Discount (99%)';
                } else if (selectedCompany === 'tata') {
                    discountRate = 0.95;
                    discountLabelText = 'TATA AIG Discount (95%)';
                } else if (selectedCompany === 'reliance') {
                    discountRate = 0.95;
                    discountLabelText = 'Reliance General Discount (95%)';
                    towingCharge = 500;
                } else if (selectedCompany === 'icici') {
                    discountRate = 0.99;
                    discountLabelText = 'ICICI Lombard Discount (99%)';
                    towingCharge = 0;
                }

                const odPremiumAfterCompanyDiscount = odPremiumAfterNcb * (1 - discountRate);
                const imt23PremiumAfterCompanyDiscount = imt23PremiumBeforeDiscount * (1 - discountRate);
                const cngOdPremiumAfterDiscount = isCngFuel ? cngOdPremium * (1 - discountRate) : 0;

                const companyDiscountAmount = (odPremiumAfterNcb + imt23PremiumBeforeDiscount + cngOdPremium) * discountRate;

                const basicTpPremium = 12192;
                const licensedPassengerPremium = licensedPassengers * 745;
                const totalTpPremium = basicTpPremium + licensedPassengerPremium;
                
                let cngTpPremium = isCngFuel ? 60 : 0;
                let llDriverPremium = llDriverValue > 0 ? (llDriverValue === 1 ? 50 : (llDriverValue === 2 ? 100 : llDriverValue * licensedPassengers)) : 0;
                
                const totalPremiumBeforeGst = odPremiumAfterCompanyDiscount + imt23PremiumAfterCompanyDiscount + totalTpPremium + towingCharge + cngTpPremium + cngOdPremiumAfterDiscount + llDriverPremium;
                
                const gstAmount = totalPremiumBeforeGst * 0.18;
                const finalTotalPremiumWithGst = totalPremiumBeforeGst + gstAmount;

                // Update the global calculatedData object
                calculatedData = {
                    idv,
                    seatingCapacity,
                    licensedPassengers,
                    odPremiumAfterCompanyDiscount,
                    cngOdPremiumAfterDiscount,
                    totalTpPremium,
                    imt23PremiumAfterCompanyDiscount,
                    towingCharge,
                    cngTpPremium,
                    llDriverPremium,
                    companyDiscountLabel: discountLabelText,
                    companyDiscountAmount,
                    subtotalPremium: totalPremiumBeforeGst,
                    gstAmount,
                    totalPremium: finalTotalPremiumWithGst,
                };

                // Display all breakdown lines, even if zero
                document.getElementById('odPremium').textContent = formatCurrency(calculatedData.odPremiumAfterCompanyDiscount);
                document.getElementById('cngOdPremiumAmount').textContent = formatCurrency(calculatedData.cngOdPremiumAfterDiscount);
                document.getElementById('tpPremium').textContent = formatCurrency(calculatedData.totalTpPremium);
                document.getElementById('imt23Premium').textContent = formatCurrency(calculatedData.imt23PremiumAfterCompanyDiscount);
                document.getElementById('towingChargePremium').textContent = formatCurrency(calculatedData.towingCharge);
                document.getElementById('cngTpPremiumAmount').textContent = formatCurrency(calculatedData.cngTpPremium);
                document.getElementById('llDriverPremiumAmount').textContent = formatCurrency(calculatedData.llDriverPremium);
                document.getElementById('companyDiscountLabel').textContent = calculatedData.companyDiscountLabel;
                document.getElementById('companyDiscountAmount').textContent = formatCurrency(calculatedData.companyDiscountAmount, true);
                
                document.getElementById('subtotalPremium').textContent = formatCurrency(calculatedData.subtotalPremium);
                document.getElementById('gstAmount').textContent = formatCurrency(calculatedData.gstAmount);
                document.getElementById('totalPremium').textContent = formatCurrency(calculatedData.totalPremium);

                resultsSection.classList.remove('hidden');
            };

            const calculateAndDisplayCommission = () => {
                const totalPremiumBeforeGst = calculatedData?.subtotalPremium || 0;
                const commissionRateInput = parseFloat(document.getElementById('commissionRate').value);
                
                if (isNaN(totalPremiumBeforeGst) || totalPremiumBeforeGst === 0) {
                     document.getElementById('premiumForCommission').textContent = formatCurrency(0);
                     document.getElementById('basicCommission').textContent = formatCurrency(0);
                     document.getElementById('tdsOnCommission').textContent = formatCurrency(0);
                     document.getElementById('totalCommission').textContent = formatCurrency(0);
                     return;
                }
                
                const commissionRate = commissionRateInput / 100;
                const basicCommission = totalPremiumBeforeGst * commissionRate;
                const tdsRate = 0.02;
                const tdsOnCommission = basicCommission * tdsRate;
                const totalCommission = basicCommission - tdsOnCommission;
                
                document.getElementById('premiumForCommission').textContent = formatCurrency(totalPremiumBeforeGst);
                document.getElementById('commissionRateDisplay').textContent = commissionRateInput;
                document.getElementById('basicCommission').textContent = formatCurrency(basicCommission);
                document.getElementById('tdsOnCommission').textContent = formatCurrency(tdsOnCommission);
                document.getElementById('totalCommission').textContent = formatCurrency(totalCommission);
            };

            premiumForm.addEventListener('submit', function(event) {
                event.preventDefault();
                calculateAndDisplayPremium();
            });

            seatingCapacityInput.addEventListener('input', function() {
                const seatingCapacity = parseInt(this.value);
                const licensedPassengers = seatingCapacity > 0 ? seatingCapacity - 1 : 0;
                carryingCapacityDisplay.value = licensedPassengers > 0 ? licensedPassengers : "N/A";
            });

            const toggleCommissionBtn = document.getElementById('toggleCommissionBtn');
            const commissionModal = document.getElementById('commissionModal');
            const closeModalBtn = document.getElementById('closeModalBtn');
            const commissionRateInput = document.getElementById('commissionRate');

            toggleCommissionBtn.addEventListener('click', function() {
                if (!Object.keys(calculatedData).length) {
                     showMessage("Please calculate the premium first.");
                     return;
                }
                commissionModal.classList.remove('hidden');
                calculateAndDisplayCommission();
            });

            closeModalBtn.addEventListener('click', function() {
                commissionModal.classList.add('hidden');
            });
            
            commissionRateInput.addEventListener('input', calculateAndDisplayCommission);

            const generatePdfBtn = document.getElementById('generatePdfBtn');
            const generatePdfText = document.getElementById('generatePdfText');
            const generatePdfLoader = document.getElementById('generatePdfLoader');
            const pdfContent = document.getElementById('pdfContent');
            
            generatePdfBtn.addEventListener('click', () => {
                if (!Object.keys(calculatedData).length) {
                    showMessage("Please calculate the premium first.");
                    return;
                }
                
                // Update the PDF content with the calculated data
                document.getElementById('pdf-idv').textContent = formatCurrency(calculatedData.idv);
                document.getElementById('pdf-seating-capacity').textContent = calculatedData.seatingCapacity;
                document.getElementById('pdf-od-premium').textContent = formatCurrency(calculatedData.odPremiumAfterCompanyDiscount);
                document.getElementById('pdf-cng-od-premium').textContent = formatCurrency(calculatedData.cngOdPremiumAfterDiscount);
                document.getElementById('pdf-company-discount-label').textContent = calculatedData.companyDiscountLabel;
                document.getElementById('pdf-company-discount-amount').textContent = formatCurrency(calculatedData.companyDiscountAmount, true);
                document.getElementById('pdf-tp-premium').textContent = formatCurrency(calculatedData.totalTpPremium);
                document.getElementById('pdf-imt23-premium').textContent = formatCurrency(calculatedData.imt23PremiumAfterCompanyDiscount);
                document.getElementById('pdf-towing-charge').textContent = formatCurrency(calculatedData.towingCharge);
                document.getElementById('pdf-cng-tp-premium').textContent = formatCurrency(calculatedData.cngTpPremium);
                document.getElementById('pdf-ll-driver-premium').textContent = formatCurrency(calculatedData.llDriverPremium);
                document.getElementById('pdf-subtotal-premium').textContent = formatCurrency(calculatedData.subtotalPremium);
                document.getElementById('pdf-gst-amount').textContent = formatCurrency(calculatedData.gstAmount);
                document.getElementById('pdf-total-premium').textContent = formatCurrency(calculatedData.totalPremium);

                // Temporarily disable the button and show loading state
                generatePdfBtn.disabled = true;
                generatePdfText.textContent = 'Generating...';
                generatePdfLoader.classList.remove('hidden');
                
                // Use a short delay to allow the DOM to update before printing
                setTimeout(() => {
                    window.print();
                    
                    // Re-enable the button and hide loading state after printing
                    generatePdfBtn.disabled = false;
                    generatePdfText.textContent = 'Generate PDF';
                    generatePdfLoader.classList.add('hidden');
                }, 500);
            });
        });

        // Helper function to format numbers as Indian Rupees
        function formatCurrency(amount, isDiscount = false) {
            const formatter = new Intl.NumberFormat('en-IN', {
                style: 'currency',
                currency: 'INR',
                minimumFractionDigits: 2,
            });

            if (isDiscount) {
                return `- ${formatter.format(amount).replace('₹', '')}`;
            } else {
                return formatter.format(amount);
            }
        }
    
</script>
</body>
</html>
